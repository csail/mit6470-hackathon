//** Animated Collapsible DIV v2.0- (c) Dynamic Drive DHTML code library: http://www.dynamicdrive.com.
//** May 24th, 08'- Script rewritten and updated to 2.0.
//** June 4th, 08'- Version 2.01: Bug fix to work with jquery 1.2.6 (which changed the way attr() behaves).
//** March 5th, 09'- Version 2.2, which adds the following:
//1) ontoggle($, divobj, state) event that fires each time a DIV is expanded/collapsed, including when the page 1st loads
//2) Ability to expand a DIV via a URL parameter string, ie: index.htm?expanddiv=jason or index.htm?expanddiv=jason,kelly
//** March 9th, 09'- Version 2.2.1: Optimized ontoggle event handler slightly.
//** July 3rd, 09'- Version 2.4, which adds the following:
//1) You can now insert rel="expand[divid] | collapse[divid] | toggle[divid]" inside arbitrary links to act as DIV togglers
//2) For image toggler links, you can insert the attributes "data-openimage" and "data-closedimage" to update its image based on the DIV state
var animatedcollapse={divholders:{},divgroups:{},lastactiveingroup:{},preloadimages:[],show:function(e){if(typeof e=="object")for(var t=0;t<e.length;t++)this.showhide(e[t],"show");else this.showhide(e,"show")},hide:function(e){if(typeof e=="object")for(var t=0;t<e.length;t++)this.showhide(e[t],"hide");else this.showhide(e,"hide")},toggle:function(e){typeof e=="object"&&(e=e[0]),this.showhide(e,"toggle")},addDiv:function(e,t){return this.divholders[e]={id:e,$divref:null,attrs:t},this.divholders[e].getAttr=function(e){var t=new RegExp(e+"=([^,]+)","i");return t.test(this.attrs)&&parseInt(RegExp.$1)!=0?RegExp.$1:null},this.currentid=e,this},showhide:function(e,t){var n=this.divholders[e].$divref;if(this.divholders[e]&&n.length==1){var r=this.divgroups[n.attr("groupname")];n.attr("groupname")&&r.count>1&&(t=="show"||t=="toggle"&&n.css("display")=="none")?(r.lastactivedivid&&r.lastactivedivid!=e&&this.slideengine(r.lastactivedivid,"hide"),this.slideengine(e,"show"),r.lastactivedivid=e):this.slideengine(e,t)}},slideengine:function(e,t){var n=this.divholders[e].$divref,r=this.divholders[e].$togglerimage;if(this.divholders[e]&&n.length==1){var i={height:t};return n.attr("fade")&&(i.opacity=t),n.animate(i,n.attr("speed")?parseInt(n.attr("speed")):500,function(){r&&r.attr("src",n.css("display")=="none"?r.data("srcs").closed:r.data("srcs").open);if(animatedcollapse.ontoggle)try{animatedcollapse.ontoggle(jQuery,n.get(0),n.css("display"))}catch(e){alert('An error exists inside your "ontoggle" function:\n\n'+e+"\n\nAborting execution of function.")}}),!1}},generatemap:function(){var e={};for(var t=0;t<arguments.length;t++)arguments[t][1]!=null&&(e[arguments[t][0]]=arguments[t][1]);return e},init:function(){var e=this;jQuery(document).ready(function(t){animatedcollapse.ontoggle=animatedcollapse.ontoggle||null;var n=animatedcollapse.urlparamselect(),r=e.getCookie("acopendivids"),i=e.getCookie("acgroupswithpersist");r!=null&&(r=r=="nada"?[]:r.split(",")),i=i==null||i=="nada"?[]:i.split(","),jQuery.each(e.divholders,function(){this.$divref=t("#"+this.id);if(!this.getAttr("persist")&&jQuery.inArray(this.getAttr("group"),i)==-1||r==null)var s=this.getAttr("hide")?"none":null;else var s=jQuery.inArray(this.id,r)!=-1?"block":"none";n[0]=="all"||jQuery.inArray(this.id,n)!=-1?s="block":n[0]=="none"&&(s="none"),this.$divref.css(e.generatemap(["height",this.getAttr("height")],["display",s])),this.$divref.attr(e.generatemap(["groupname",this.getAttr("group")],["fade",this.getAttr("fade")],["speed",this.getAttr("speed")]));if(this.getAttr("group")){var o=e.divgroups[this.getAttr("group")]||(e.divgroups[this.getAttr("group")]={});o.count=(o.count||0)+1,jQuery.inArray(this.id,n)!=-1&&(o.lastactivedivid=this.id,o.overridepersist=1);if(!o.lastactivedivid&&this.$divref.css("display")!="none"||s=="block"&&typeof o.overridepersist=="undefined")o.lastactivedivid=this.id;this.$divref.css({display:"none"})}}),jQuery.each(e.divgroups,function(){this.lastactivedivid&&n[0]!="none"&&e.divholders[this.lastactivedivid].$divref.show()}),animatedcollapse.ontoggle&&jQuery.each(e.divholders,function(){animatedcollapse.ontoggle(jQuery,this.$divref.get(0),this.$divref.css("display"))});var s=t("a[rel]").filter('[rel^="collapse["], [rel^="expand["], [rel^="toggle["]');s.each(function(){this._divids=this.getAttribute("rel").replace(/(^\w+)|(\s+)/g,"").replace(/[\[\]']/g,""),this.getElementsByTagName("img").length==1&&e.divholders[this._divids]&&(animatedcollapse.preloadimage(this.getAttribute("data-openimage"),this.getAttribute("data-closedimage")),$togglerimage=t(this).find("img").eq(0).data("srcs",{open:this.getAttribute("data-openimage"),closed:this.getAttribute("data-closedimage")}),e.divholders[this._divids].$togglerimage=t(this).find("img").eq(0),e.divholders[this._divids].$togglerimage.attr("src",e.divholders[this._divids].$divref.css("display")=="none"?$togglerimage.data("srcs").closed:$togglerimage.data("srcs").open)),t(this).click(function(){var e=this.getAttribute("rel"),t=this._divids==""?[]:this._divids.split(",");if(t.length>0)return animatedcollapse[/expand/i.test(e)?"show":/collapse/i.test(e)?"hide":"toggle"](t),!1})}),t(window).bind("unload",function(){e.uninit()})})},uninit:function(){var e="",t="";jQuery.each(this.divholders,function(){this.$divref.css("display")!="none"&&(e+=this.id+","),this.getAttr("group")&&this.getAttr("persist")&&(t+=this.getAttr("group")+",")}),e=e==""?"nada":e.replace(/,$/,""),t=t==""?"nada":t.replace(/,$/,""),this.setCookie("acopendivids",e),this.setCookie("acgroupswithpersist",t)},getCookie:function(e){var t=new RegExp(e+"=[^;]*","i");return document.cookie.match(t)?document.cookie.match(t)[0].split("=")[1]:null},setCookie:function(e,t,n){if(typeof n!="undefined"){var r=new Date;r.setDate(r.getDate()+n),document.cookie=e+"="+t+"; path=/; expires="+r.toGMTString()}else document.cookie=e+"="+t+"; path=/"},urlparamselect:function(){return window.location.search.match(/expanddiv=([\w\-_,]+)/i),RegExp.$1!=""?RegExp.$1.split(","):[]},preloadimage:function(){var e=this.preloadimages;for(var t=0;t<arguments.length;t++)arguments[t]&&arguments[t].length>0&&(e[e.length]=new Image,e[e.length-1].src=arguments[t])}};